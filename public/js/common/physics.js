// Code generated by deno task bundle. DO NOT EDIT. Unless you're a 1337H4X0R.
// Then move on.

export class Engine {
    constructor(map) {
        this.map = map;
        this.gravity = 0.3;
    }
    tickEntities(entities, deltaTime = 0) {
        const updates = [];
        for (const [_, entity] of entities) {
            const pos = { ...entity.position }; // copy so tickEntity can mutate
            this.tickEntity(entity, deltaTime);
            if (pos.x != entity.position.x || pos.y != entity.position.y) {
                updates.push(entity);
            }
        }
        return updates;
    }
    tickEntity(entity, deltaTime = 1) {
        const isGrounded = this.checkGrounded(entity, this.map);
        if (isGrounded) {
            entity.velocity.y = 0;
            entity.acceleration.y = 0;
        }
        entity.velocity.x += entity.acceleration.x * deltaTime;
        entity.velocity.y += entity.acceleration.y * deltaTime;
        entity.tick(deltaTime);
        entity.position.x += entity.velocity.x * deltaTime;
        entity.position.y += entity.velocity.y * deltaTime;
    }
    checkGrounded(entity, map) {
        let isGrounded = false;
        map.iterate((pos, _, __, mods) => {
            if (!mods.includes("air") && pos.y - entity.position.y < 1) {
                isGrounded = true;
                return;
            }
        });
        return isGrounded;
    }
}
